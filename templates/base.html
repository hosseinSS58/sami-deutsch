{% load static %}
<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="csrf-token" content="{{ csrf_token }}">
  <title>{% block title %}Sami Language{% endblock %}</title>
  <meta name="description" content="{{ site_settings.meta_description|default:'آموزش زبان با دوره‌ها، ویدئوها و مقالات کاربردی.' }}">
  <meta property="og:title" content="Sami Language">
  <meta property="og:description" content="آموزش زبان با دوره‌ها، ویدئوها و مقالات کاربردی.">
  <meta property="og:type" content="website">
  <link rel="alternate" type="application/rss+xml" title="Blog" href="/sitemap.xml">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" rel="stylesheet">
      <link href="{% static 'css/app.css' %}" rel="stylesheet">
    <link href="{% static 'css/dynamic-styles.css' %}" rel="stylesheet">
    <link href="{% static 'css/advanced-styles.css' %}" rel="stylesheet">
    <link href="{% static 'css/animations.css' %}" rel="stylesheet">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" href="{% static 'img/favicon.svg' %}" type="image/svg+xml">
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  
  <!-- Dynamic CSS Variables from Site Settings -->
  <style>
    :root {
      --site-primary-color: {{ site_settings.primary_color|default:'#0d6efd' }};
      --site-navbar-bg-color: {{ site_settings.navbar_bg_color|default:'#0d6efd' }};
      --site-navbar-text-color: {{ site_settings.navbar_text_color|default:'#ffffff' }};
      --site-navbar-hover-color: {{ site_settings.navbar_hover_color|default:'#0b5ed7' }};
      --site-button-primary-bg: {{ site_settings.button_primary_bg|default:'#0d6efd' }};
      --site-button-primary-text: {{ site_settings.button_primary_text|default:'#ffffff' }};
      --site-button-secondary-bg: {{ site_settings.button_secondary_bg|default:'#6c757d' }};
      --site-button-secondary-text: {{ site_settings.button_secondary_text|default:'#ffffff' }};
      --site-button-outline-color: {{ site_settings.button_outline_color|default:'#0d6efd' }};
      --site-card-bg-color: {{ site_settings.card_bg_color|default:'#ffffff' }};
      --site-card-border-color: {{ site_settings.card_border_color|default:'#dee2e6' }};
      --site-card-shadow-color: {{ site_settings.card_shadow_color|default:'rgba(0,0,0,0.1)' }};
      --site-text-primary-color: {{ site_settings.text_primary_color|default:'#0f172a' }};
      --site-text-secondary-color: {{ site_settings.text_secondary_color|default:'#6c757d' }};
      --site-text-muted-color: {{ site_settings.text_muted_color|default:'#adb5bd' }};
      --site-body-bg-color: {{ site_settings.body_bg_color|default:'#ffffff' }};
      --site-section-bg-color: {{ site_settings.section_bg_color|default:'#f8f9fa' }};
      --site-footer-bg-color: {{ site_settings.footer_bg_color|default:'#212529' }};
      --site-footer-text-color: {{ site_settings.footer_text_color|default:'#ffffff' }};
      --site-link-color: {{ site_settings.link_color|default:'#0d6efd' }};
      --site-link-hover-color: {{ site_settings.link_hover_color|default:'#0a58ca' }};
      --site-success-color: {{ site_settings.success_color|default:'#198754' }};
      --site-error-color: {{ site_settings.error_color|default:'#dc3545' }};
      --site-warning-color: {{ site_settings.warning_color|default:'#ffc107' }};
      --site-info-color: {{ site_settings.info_color|default:'#0dcaf0' }};
      --site-heading-font-family: {{ site_settings.heading_font_family|default:'Vazirmatn' }};
      --site-body-font-family: {{ site_settings.body_font_family|default:'Vazirmatn' }};
      --site-base-font-size: {{ site_settings.base_font_size|default:'16px' }};
      --site-container-max-width: {{ site_settings.container_max_width|default:'1200px' }};
      --site-section-padding: {{ site_settings.section_padding|default:'4rem' }};
      --site-card-border-radius: {{ site_settings.card_border_radius|default:'0.375rem' }};
    }
    
    /* Custom CSS from admin */
    {{ site_settings.custom_css|safe }}
  </style>
</head>
<body>
  <header class="sticky-top bg-white">
    <nav class="navbar navbar-expand-lg shadow-sm" aria-label="Main navigation">
      <div class="container">
        <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="/">
          {% if site_settings.logo %}
            <img src="{{ site_settings.logo.url }}" alt="{{ site_settings.brand_name }}" width="28" height="28"/>
          {% else %}
            <img src="{% static 'logo.svg' %}" alt="{{ site_settings.brand_name }}" width="28" height="28"/>
          {% endif %}
          <span>{{ site_settings.brand_name }}</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu" aria-controls="mobileMenu" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarDesktop">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0 align-items-lg-center">
            {% if header_menu and header_menu.items.all|length %}
              {% for item in header_menu.items.all %}
                {% if item.children.all|length %}
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="{{ item.url }}" data-bs-toggle="dropdown">{{ item.title }}</a>
                    <ul class="dropdown-menu shadow border-0 rounded-3">
                      {% for ch in item.children.all %}
                        <li><a class="dropdown-item" href="{{ ch.url }}">{{ ch.title }}</a></li>
                      {% endfor %}
                    </ul>
                  </li>
                {% else %}
                  <li class="nav-item"><a class="nav-link" href="{{ item.url }}">{{ item.title }}</a></li>
                {% endif %}
              {% endfor %}
            {% else %}
              {% if site_settings.show_default_nav_links %}
                <li class="nav-item"><a class="nav-link" href="/">خانه</a></li>
                <li class="nav-item"><a class="nav-link" href="/videos/">ویدیوها</a></li>
                <li class="nav-item"><a class="nav-link" href="/shop/">فروشگاه</a></li>
                <li class="nav-item"><a class="nav-link" href="/blog/">بلاگ</a></li>
                <li class="nav-item"><a class="nav-link" href="/assess/">تعیین سطح</a></li>
                <li class="nav-item"><a class="nav-link" href="/contact/">تماس</a></li>
              {% else %}
                {% for link in nav_links %}
                  <li class="nav-item"><a class="nav-link" href="{{ link.url }}">{{ link.title }}</a></li>
                {% empty %}
                  <li class="nav-item"><a class="nav-link" href="/">خانه</a></li>
                {% endfor %}
              {% endif %}
            {% endif %}
          </ul>

          <form class="d-none d-lg-flex position-relative me-3" role="search" action="/search/" x-data="{s:[],q:''}">
            <input class="form-control" type="search" placeholder="جستجو" name="q" x-model="q" x-on:input.debounce.200ms="fetch('/search/suggest/?q='+encodeURIComponent(q)).then(r=>r.json()).then(d=>s=d.suggestions)">
            <div class="position-absolute bg-white shadow rounded w-100 mt-5" x-show="s.length && q" style="top:0; z-index: 1000;">
              <ul class="list-group list-group-flush">
                <template x-for="it in s" :key="it">
                  <li class="list-group-item"><a :href="'/search/?q='+encodeURIComponent(it)" x-text="it"></a></li>
                </template>
              </ul>
            </div>
          </form>

          <div class="d-flex align-items-center gap-2">
            {% if user.is_authenticated %}
              <div class="dropdown">
                <a class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">حساب کاربری</a>
                <ul class="dropdown-menu dropdown-menu-end shadow border-0 rounded-3">
                  <li><a class="dropdown-item" href="{% url 'accounts:profile' %}">پروفایل</a></li>
                  <li>
                    <form method="post" action="{% url 'accounts:logout' %}">
                      {% csrf_token %}
                      <button class="dropdown-item" type="submit">خروج</button>
                    </form>
                  </li>
                </ul>
              </div>
            {% else %}
              <a class="btn btn-outline-primary" href="/accounts/login/">ورود</a>
              <a class="btn btn-primary" href="/accounts/signup/">ثبت‌نام</a>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>

    <!-- Offcanvas Mobile Menu -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="mobileMenuLabel">{{ site_settings.brand_name }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body d-flex flex-column gap-3">
        <form class="d-flex position-relative" role="search" action="/search/" x-data="{s:[],q:''}">
          <input class="form-control" type="search" placeholder="جستجو" name="q" x-model="q" x-on:input.debounce.200ms="fetch('/search/suggest/?q='+encodeURIComponent(q)).then(r=>r.json()).then(d=>s=d.suggestions)">
        </form>
        <ul class="list-unstyled m-0">
          <li class="mb-2"><a class="text-decoration-none" href="/">خانه</a></li>
          <li class="mb-2"><a class="text-decoration-none" href="/videos/">ویدیوها</a></li>
          <li class="mb-2"><a class="text-decoration-none" href="/shop/">فروشگاه</a></li>
          <li class="mb-2"><a class="text-decoration-none" href="/blog/">بلاگ</a></li>
          <li class="mb-2"><a class="text-decoration-none" href="/contact/">تعیین سطح</a></li>
          <li class="mb-2"><a class="text-decoration-none" href="/contact/">تماس</a></li>
          {% for link in nav_links %}
            <li class="mb-2"><a class="text-decoration-none" href="{{ link.url }}">{{ link.title }}</a></li>
          {% endfor %}
        </ul>
        
        <div class="mt-auto">
          {% if user.is_authenticated %}
            <a class="btn w-100 btn-outline-primary mb-2" href="{% url 'accounts:profile' %}">پروفایل</a>
            <form method="post" action="{% url 'accounts:logout' %}">
              {% csrf_token %}
              <button class="btn w-100 btn-primary" type="submit">خروج</button>
            </form>
          {% else %}
            <a class="btn w-100 btn-outline-primary mb-2" href="/accounts/login/">ورود</a>
            <a class="btn w-100 btn-primary" href="/accounts/signup/">ثبت‌نام</a>
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <main class="py-4">
    <div class="container">
      {% block content %}{% endblock %}
    </div>
  </main>

  <footer class="border-top mt-4 py-4">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">
      <div class="text-muted small">{{ site_settings.footer_text }}</div>
      <ul class="nav">
        {% for link in footer_links %}
          <li class="nav-item"><a class="nav-link" href="{{ link.url }}">{{ link.title }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


